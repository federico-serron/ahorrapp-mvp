<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="Expense Tracker - Gestiona tus ingresos y gastos">
    <!-- CSP Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self'; connect-src 'self' http://localhost:5001">
    <title> Expense Tracker Pro</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" integrity="sha384-eNQQvKzJqDup2z3FoRRkJiKZeDJnXvi5margin" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="css/styles.css">
</head>
<body>
    <div class="container">
        <!-- AUTH SECTION -->
        <div id="authSection">
            <div class="header">
                <h1> Expense Tracker Pro</h1>
            </div>

            <div class="card auth-form">
                <div class="tab-buttons">
                    <button class="tab-btn active" id="tabLogin">Login</button>
                    <button class="tab-btn inactive" id="tabRegister">Registro</button>
                </div>

                <!-- LOGIN -->
                <form id="loginForm" class="tab-content">
                    <h2>Inicia Sesi贸n</h2>
                    <div class="form-group">
                        <label for="loginUsername">Usuario</label>
                        <input 
                            type="text" 
                            id="loginUsername"
                            name="username"
                            minlength="3"
                            maxlength="20"
                            pattern="^[a-zA-Z0-9_-]+$"
                            required
                            autocomplete="username"
                        >
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Contrase帽a</label>
                        <input 
                            type="password" 
                            id="loginPassword"
                            name="password"
                            minlength="4"
                            maxlength="128"
                            required
                            autocomplete="current-password"
                        >
                    </div>
                    <button type="submit">Login</button>
                    <div class="message" id="loginMessage"></div>
                </form>

                <!-- REGISTER -->
                <form id="registerForm" class="tab-content hidden">
                    <h2>Crear Cuenta</h2>
                    <div class="form-group">
                        <label for="regUsername">Usuario (煤nico)</label>
                        <input 
                            type="text" 
                            id="regUsername"
                            name="username"
                            minlength="3"
                            maxlength="20"
                            pattern="^[a-zA-Z0-9_-]+$"
                            required
                            autocomplete="username"
                        >
                    </div>
                    <div class="form-group">
                        <label for="regPassword">Contrase帽a (m铆n 4 caracteres)</label>
                        <input 
                            type="password" 
                            id="regPassword"
                            name="password"
                            minlength="4"
                            maxlength="128"
                            required
                            autocomplete="new-password"
                        >
                    </div>
                    <button type="submit">Registrarse</button>
                    <div class="message" id="registerMessage"></div>
                </form>
            </div>
        </div>

        <!-- APP SECTION -->
        <div id="appSection" class="hidden">
            <div class="header">
                <h1> Expense Tracker Pro</h1>
                <p id="userName"></p>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>

            <!-- STATS -->
            <div class="stat-grid">
                <div class="stat-card income">
                    <div class="stat-value" id="incomeTotal">$0.00</div>
                    <div class="stat-label">Ingresos</div>
                </div>
                <div class="stat-card expense">
                    <div class="stat-value" id="expenseTotal">$0.00</div>
                    <div class="stat-label">Gastos</div>
                </div>
                <div class="stat-card balance">
                    <div class="stat-value" id="balanceTotal">$0.00</div>
                    <div class="stat-label">Balance</div>
                </div>
            </div>

            <!-- CHARTS -->
            <div class="charts-grid">
                <div class="card">
                    <h3>Gastos por Categor铆a</h3>
                    <div class="chart-container">
                        <canvas id="categoryChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h3>Ingresos vs Gastos</h3>
                    <div class="chart-container">
                        <canvas id="incomeExpenseChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- ADD TRANSACTION -->
            <div class="card">
                <h2>Nueva Transacci贸n</h2>
                <form id="transactionForm" novalidate>
                    <div class="form-group">
                        <label for="description">Descripci贸n</label>
                        <input 
                            type="text" 
                            id="description"
                            name="description"
                            placeholder="Ej: Sueldo mensual o Cine con amigos"
                            minlength="1"
                            maxlength="500"
                            required
                        >
                    </div>
                    <div class="form-group">
                        <label for="amount">Monto</label>
                        <input 
                            type="number" 
                            id="amount"
                            name="amount"
                            placeholder="Ej: 100.00"
                            step="0.01"
                            min="-1000000"
                            max="1000000"
                            required
                        >
                    </div>
                    <button type="submit" id="submitBtn">Registrar</button>
                    <div class="message" id="message"></div>
                </form>
            </div>

            <!-- TRANSACTIONS LIST -->
            <div class="card">
                <h2>Historial de Transacciones</h2>
                <div class="transactions-list" id="transactionsList">
                    <p style="color: #999; text-align: center; padding: 20px;">Cargando...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- EDIT MODAL -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>Editar Transacci贸n</h2>
            <form id="editForm" novalidate>
                <div class="form-group">
                    <label for="editDescription">Descripci贸n</label>
                    <input 
                        type="text" 
                        id="editDescription"
                        name="description"
                        minlength="1"
                        maxlength="500"
                        required
                    >
                </div>
                <div class="form-group">
                    <label for="editAmount">Monto</label>
                    <input 
                        type="number" 
                        id="editAmount"
                        name="amount"
                        step="0.01"
                        min="-1000000"
                        max="1000000"
                        required
                    >
                </div>
                <button type="submit">Guardar</button>
                <button type="button" class="btn-danger" onclick="window.transactionsComponent.handleDelete()">Eliminar</button>
            </form>
        </div>
    </div>

    <!-- Scripts -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
